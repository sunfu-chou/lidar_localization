<launch>

    <node name="map_to_odom" pkg="tf2_ros" type="static_transform_publisher" args="0 0 0 0 0 0 1 map odom"/>
    <!-- <node name="robot_to_odom" pkg="tf2_ros" type="static_transform_publisher" args="1.875 0.15 0 0 0 0 1 odom base_footprint"/> -->
    <node name="base_link_to_laser" pkg="tf2_ros" type="static_transform_publisher" args="0 0 0 0 0 -0.035 0.999 base_footprint laser_frame"/>
  
    <node name="scans_merger" pkg="lidar_localization" type="laser_scan_tranformer_node" output="screen">
      <param name="active"            value="true"/>
      <param name="publish_pcl"       value="true"/>
  
      <param name="ranges_num"        value="1440"/>
  
      <param name="min_scanner_range" value="0.05"/>
      <param name="max_scanner_range" value="10.0"/>
  
      <param name="min_x_range"       value="-2.1"/>
      <param name="max_x_range"       value="0.2"/>
      <param name="min_y_range"       value="-0.5"/>
      <param name="max_y_range"       value="3.2"/>
  
      <param name="fixed_frame_id"   value="odom"/>
      <param name="target_frame_id"   value="base_footprint"/>

    </node>

    <node name="obstacle_extractor" pkg="obstacle_detector" type="obstacle_extractor_node">
      <param name="active" value="true"/>
      <param name="use_scan" value="false"/>
      <param name="use_pcl" value="true"/>
  
      <param name="use_split_and_merge" value="true"/>
      <param name="circles_from_visibles" value="true"/>
      <param name="discard_converted_segments" value="false"/>
      <param name="transform_coordinates" value="true"/>
  
      <param name="min_group_points" value="2"/>
  
      <param name="max_group_distance" value="0.04"/>
      <param name="distance_proportion" value="0.00628"/>
      <param name="max_split_distance" value="0.02"/>
      <param name="max_merge_separation" value="0.1"/>
      <param name="max_merge_spread" value="0.02"/>
      <param name="max_circle_radius" value="0.2"/>
      <param name="radius_enlargement" value="0.05"/>
  
      <param name="frame_id" value="base_footprint"/>
      <remap from="pcl" to="pcl_tf"/>

    </node>
    
    <node name="obstacle_tracker" pkg="obstacle_detector" type="obstacle_tracker_node">
      <param name="active" value="true"/>
  
      <param name="loop_rate" value="12.0"/>
      <param name="tracking_duration" value="0.5"/>
      <param name="min_correspondence_cost" value="0.6"/>
      <param name="std_correspondence_dev" value="0.15"/>
      <param name="process_variance" value="0.1"/>
      <param name="process_rate_variance" value="0.1"/>
      <param name="measurement_variance" value="1.0"/>
  
      <param name="frame_id" value="base_footprint"/>
  
      <remap from="tracked_obstacles" to="obstacles"/>
    </node>

    <node name="lidar_localization" pkg="lidar_localization" type="lidar_localization_node" output="screen">
      <param name="active" value="true"/>

      <param name="cov_x" value="0.2"/>
      <param name="cov_y" value="0.2"/>
      <param name="cov_yaw" value="0.1"/>

      <param name="beacon_1_x" value="0.947427752099"/>
      <param name="beacon_1_y" value="-0.0771323726679"/>

      <param name="beacon_2_x" value="-0.077246109604"/>
      <param name="beacon_2_y" value="3.16949267652"/>

      <param name="beacon_3_x" value="1.86671729768"/>
      <param name="beacon_3_y" value="3.16267334601"/>

      <param name="obstacle_topic" value="raw_obstacles"/>
      <param name="beacon_parent_frame_id" value="map"/>
      <param name="beacon_frame_id_prefix" value="beacon"/>
      <param name="robot_parent_frame_id" value="map"/>
      <param name="robot_frame_id" value="base_footprint"/>
    </node>

    <!-- <node pkg="lidar_localization" type="rx_to_odom" name="rx_to_odom">
      <param name="active" value="true"/>
      <param name="publish_topic" value="true"/>
      <param name="init_x" value="1.65"/>
      <param name="init_y" value="2.58"/>
      <param name="init_yaw" value="-2.66"/>
      <param name="cov_vx" value="0.05"/>
      <param name="cov_vyaw" value="0.05"/>
      <param name="delay" value="1"/>
    </node> -->
    <!-- <include file="$(find robot_localization)/launch/ekf_template.launch" /> -->

  </launch>
